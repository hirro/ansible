---
# This playbook deploys the whole application stack in this site.  

# Apply common configuration to worktajm-nginx-

- hosts: rancher-servers
  # max_fail_percentage: 0
  # serial: 1
  become: yes
  roles:
  - { role: geerlingguy.repo-epel,                  tags: [ 'stage' ]}
  - { role: cchurch.virtualenv,                     tags: [ 'stage' ]}
  - { role: docker-python,                          tags: [ 'stage' ] }
  - { role: docker-bash-aliases,                    tags: [ 'stage' ] }
  # - { role: mongodb-cluster,                      tags: [ 'install', 'mongodb-cluster' ] }
  - { role: docker-swarm-hazelcast,                 tags: [ 'install', 'docker-swarm-hazelcast' ] }

- hosts: graylog-servers
  become: yes
  roles:
  - { role: docker-containers-graylog,        tags: [ 'setup', 'graylog' ] }    

- hosts: unifi-servers
  # max_fail_percentage: 0
  # serial: 1
  become: yes
  roles:
  - { role: docker-container-unifi-video,  tags: [ 'setup', 'install', 'video', 'unifi'] }
  - { role: docker-container-unifi-controller,  tags: [ 'setup', 'install', 'controller', 'unifi'] }  



